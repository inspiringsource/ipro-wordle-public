
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IPRO Wordle</title>
    <style>
      * { box-sizing: border-box; }

      body {
        margin: 0;
        padding: 24px;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }

      .container {
        max-width: 520px;
        margin: 0 auto;
        display: grid;
        gap: 16px;
      }

      h1 {
        margin: 0;
        font-size: 20px;
        letter-spacing: 0.5px;
      }

      /* 6 rows x 5 columns */
      .board {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-auto-rows: 64px;
        gap: 10px;
      }

      .cell {
        border: 2px solid #cfcfcf;
        border-radius: 8px;
        display: grid;
        place-items: center;
        font-weight: 700;
        font-size: 24px;
        text-transform: uppercase;
        user-select: none;
      }

      form {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: center;
      }

      input[type="text"] {
        height: 44px;
        padding: 0 12px;
        font-size: 16px;
        border: 2px solid #cfcfcf;
        border-radius: 10px;
        outline: none;
        text-transform: uppercase;
      }

      input[type="text"]:focus {
        border-color: #888;
      }

      button {
        height: 44px;
        padding: 0 16px;
        font-size: 16px;
        border-radius: 10px;
        border: 2px solid #333;
        background: #333;
        color: #fff;
        cursor: pointer;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .hint {
        font-size: 13px;
        opacity: 0.75;
      }

      #result {
        min-height: 20px;
        margin: 0;
        font-size: 14px;
      }

      .error { color: #b00020; }
      .ok { color: #0b6b0b; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>IPRO Wordle</h1>

      <div id="board" class="board" aria-label="Wordle board"></div>

      <form id="guessForm" method="post" action="/postTest">
        <input
          id="postTest"
          name="postTest"
          type="text"
          maxlength="5"
          autocomplete="off"
          inputmode="text"
          aria-label="Enter a 5-letter word"
        />
        <button id="submitBtn" type="submit">Submit</button>
      </form>

      <div class="hint">6 attempts • 5 letters each</div>
      <p id="result"></p>
    </div>

    <script>
      const ROWS = 6;
      const COLS = 5;

      const boardEl = document.getElementById('board');
      const formEl = document.getElementById('guessForm');
      const inputEl = document.getElementById('postTest');
      const resultEl = document.getElementById('result');
      const submitBtn = document.getElementById('submitBtn');

      let attempt = 0;

      // Build 6x5 grid on load
      const cells = [];
      for (let i = 0; i < ROWS * COLS; i++) {
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.textContent = '';
        boardEl.appendChild(cell);
        cells.push(cell);
      }

      function setStatus(msg, kind) {
        resultEl.className = kind || '';
        resultEl.textContent = msg;
      }

      function fillRow(rowIndex, word) {
        const start = rowIndex * COLS;
        for (let i = 0; i < COLS; i++) {
          cells[start + i].textContent = word[i] || '';
        }
      }

      function lockGame() {
        inputEl.disabled = true;
        submitBtn.disabled = true;
      }

      formEl.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (attempt >= ROWS) {
          setStatus('No attempts left.', 'error');
          lockGame();
          return;
        }

        let guess = (inputEl.value || '').trim().toUpperCase();

        // Basic validation (exactly 5 letters)
        if (!/^[A-ZÄÖÜ]{5}$/.test(guess)) {
          setStatus('Please enter exactly 5 letters.', 'error');
          return;
        }

        try {
          const body = new URLSearchParams({ postTest: guess });
          const res = await fetch('/postTest', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body,
          });

          if (!res.ok) {
            throw new Error('Server error: ' + res.status);
          }

          // We expect JSON: { word: "ABCDE" }
          const data = await res.json();
          const word = (data && data.word ? String(data.word) : '').toUpperCase();

          fillRow(attempt, word);
          attempt += 1;

          inputEl.value = '';
          inputEl.focus();

          if (attempt >= ROWS) {
            setStatus('Done. You used all 6 attempts.', 'ok');
            lockGame();
          } else {
            setStatus(`Attempt ${attempt} of ${ROWS} recorded.`, 'ok');
          }
        } catch (err) {
          setStatus('Failed to submit. ' + (err?.message || ''), 'error');
        }
      });

      // Convenience: keep input uppercased
      inputEl.addEventListener('input', () => {
        inputEl.value = inputEl.value.toUpperCase();
      });

      inputEl.focus();
    </script>
  </body>
</html>
